<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚³ãƒ¡ãƒ³ãƒˆã‚°ãƒ©ãƒ• - fbaoedS3Vcs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes" />
  
  <!-- Chart.js & Zoom Plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
  
</head>
<body>
  <div class="header">ğŸ“Š ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã®æ¨ç§»</div>
  
  <div id="chart-container">
    <canvas id="commentChart"></canvas>
    <div id="scrollHint" class="scroll-hint">â† ã‚¹ãƒ¯ã‚¤ãƒ—ã§æ™‚é–“è»¸ã‚’ç§»å‹• â†’</div>
  </div>
  
  <div id="timeInfo" class="time-info"></div>
  
  <div class="controls">
    <div class="zoom-controls">
      <button id="zoomOut" class="btn zoom-btn">âˆ’</button>
      <button id="zoomIn" class="btn zoom-btn">+</button>
    </div>
    <button id="resetZoom" class="btn">ğŸ”„ 30åˆ†è¡¨ç¤º</button>
    <button id="showAll" class="btn">ğŸ“Š å…¨ä½“è¡¨ç¤º</button>
  </div>
  
  <div class="instructions">
    ğŸ“± <strong>æ“ä½œæ–¹æ³•ï¼š</strong><br>
    <span class="mobile-only">æ¨ªã‚¹ãƒ¯ã‚¤ãƒ—ã§æ™‚é–“è»¸ã‚’ç§»å‹•ã€+/âˆ’ãƒœã‚¿ãƒ³ã§ã‚ºãƒ¼ãƒ <br>
    ã‚°ãƒ©ãƒ•ã®ç‚¹ã‚’<strong>ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—</strong>ã™ã‚‹ã¨è©²å½“æ™‚é–“ã®YouTubeå‹•ç”»ã«ç§»å‹•</span>
    <span class="desktop-only">ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã§æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€Ctrl+ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ ã€ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚‚ç§»å‹•å¯èƒ½<br>
    ã‚°ãƒ©ãƒ•ã®ç‚¹ã‚’<strong>ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯</strong>ã™ã‚‹ã¨è©²å½“æ™‚é–“ã®YouTubeå‹•ç”»ã«ç§»å‹•</span>
  </div>

  <!-- ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h3>ğŸ¬ YouTubeå‹•ç”»ã‚’é–‹ãã¾ã™ã‹ï¼Ÿ</h3>
      <p id="modalTime"></p>
      <div class="modal-buttons">
        <button id="confirmYes" class="modal-btn confirm">é–‹ã</button>
        <button id="confirmNo" class="modal-btn cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>

  <script>
    const VIDEO_ID = "fbaoedS3Vcs";
    let chart;
    let pendingUrl = null;
    let chartData = [];
    let totalDuration = 0;
    let maxCommentCount = 0;
    
    // ã‚¿ãƒƒãƒæ“ä½œã®çŠ¶æ…‹ç®¡ç†
    let touchStartTime = 0;
    let touchStartX = 0;
    let touchStartY = 0;
    let isDragging = false;
    let isScrolling = false;
    let hasMoved = false;
    let isTooltipEnabled = true;
    let tooltipHideTimeout = null;

    // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—/ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯æ¤œå‡ºç”¨
    let lastTapTime = 0;
    let lastClickTime = 0;
    const doubleTapDelay = 300; // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—æ¤œå‡ºã®æ™‚é–“é–“éš”

    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®è¡¨ç¤ºåˆ¶å¾¡
    function disableTooltip() {
      isTooltipEnabled = false;
      if (chart && chart.tooltip) {
        chart.tooltip.setActiveElements([], {x: 0, y: 0});
        chart.update('none');
      }
      // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
      if (tooltipHideTimeout) {
        clearTimeout(tooltipHideTimeout);
      }
    }

    function enableTooltipWithDelay(delay = 300) {
      if (tooltipHideTimeout) {
        clearTimeout(tooltipHideTimeout);
      }
      tooltipHideTimeout = setTimeout(() => {
        isTooltipEnabled = true;
      }, delay);
    }

    // ãƒ‡ãƒã‚¤ã‚¹åˆ¤å®š
    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = Math.floor(seconds % 60);
      
      if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      } else {
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
      }
    }

    // æ™‚é–“æƒ…å ±ã‚’æ›´æ–°
    function updateTimeInfo() {
      if (!chart) return;
      
      const xScale = chart.scales.x;
      const min = Math.floor(xScale.min || 0);
      const max = Math.floor(xScale.max || totalDuration);
      const range = max - min;
      
      let rangeText = '';
      if (range >= 3600) {
        rangeText = `${Math.round(range / 3600 * 10) / 10}æ™‚é–“`;
      } else if (range >= 60) {
        rangeText = `${Math.round(range / 60)}åˆ†`;
      } else {
        rangeText = `${range}ç§’`;
      }
      
      document.getElementById('timeInfo').textContent = 
        `è¡¨ç¤ºç¯„å›²: ${formatTime(min)} ã€œ ${formatTime(max)} (${rangeText})`;
    }

    // YouTube URLã‚’ç”Ÿæˆ
    function generateYouTubeUrl(videoId, timeInSeconds) {
      return `https://www.youtube.com/watch?v=${videoId}&t=${Math.floor(timeInSeconds)}s`;
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    function showConfirmModal(timeInSeconds) {
      const modal = document.getElementById('confirmModal');
      const modalTime = document.getElementById('modalTime');
      
      modalTime.textContent = `å‹•ç”»ã® ${formatTime(timeInSeconds)} ã‹ã‚‰å†ç”Ÿã—ã¾ã™`;
      pendingUrl = generateYouTubeUrl(VIDEO_ID, timeInSeconds);
      modal.style.display = 'block';
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤º
    function hideConfirmModal() {
      document.getElementById('confirmModal').style.display = 'none';
      pendingUrl = null;
    }

    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‹ã‚‰æ™‚é–“ã‚’å–å¾—
    function getActiveTooltipTime() {
      if (!chart || !chart.tooltip || !chart.tooltip.dataPoints) {
        return null;
      }
      
      const dataPoints = chart.tooltip.dataPoints;
      if (dataPoints.length === 0) {
        return null;
      }
      
      const timeValue = dataPoints[0].parsed.x;
      return timeValue;
    }

    // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—/ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    function handleDoubleAction() {
      if (isDragging || isScrolling) {
        return;
      }
      
      const tooltipTime = getActiveTooltipTime();
      if (tooltipTime !== null) {
        showConfirmModal(tooltipTime);
      }
    }

    // ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³æ“ä½œ
    function zoomIn() {
      if (!chart) return;
      const xScale = chart.scales.x;
      const currentMin = xScale.min || 0;
      const currentMax = xScale.max || totalDuration;
      const currentRange = currentMax - currentMin;
      const newRange = Math.max(60, currentRange * 0.5);
      const center = (currentMin + currentMax) / 2;
      
      chart.options.scales.x.min = Math.max(0, center - newRange / 2);
      chart.options.scales.x.max = Math.min(totalDuration, center + newRange / 2);
      chart.update('none');
      updateTimeInfo();
    }

    function zoomOut() {
      if (!chart) return;
      const xScale = chart.scales.x;
      const currentMin = xScale.min || 0;
      const currentMax = xScale.max || totalDuration;
      const currentRange = currentMax - currentMin;
      const newRange = Math.min(totalDuration, currentRange * 2);
      const center = (currentMin + currentMax) / 2;
      
      chart.options.scales.x.min = Math.max(0, center - newRange / 2);
      chart.options.scales.x.max = Math.min(totalDuration, center + newRange / 2);
      chart.update('none');
      updateTimeInfo();
    }

    function resetZoom() {
      if (!chart) return;
      chart.options.scales.x.min = 0;
      chart.options.scales.x.max = Math.min(1800, totalDuration);
      chart.update('none');
      updateTimeInfo();
    }

    function showAll() {
      if (!chart) return;
      chart.options.scales.x.min = 0;
      chart.options.scales.x.max = totalDuration;
      chart.update('none');
      updateTimeInfo();
    }

    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ’ãƒ³ãƒˆã®è¡¨ç¤ºåˆ¶å¾¡
    function showScrollHint() {
      const hint = document.getElementById('scrollHint');
      hint.classList.add('show');
    }

    function hideScrollHint() {
      const hint = document.getElementById('scrollHint');
      hint.classList.remove('show');
    }

    function showScrollHintTemporary(duration = 3000) {
      showScrollHint();
      setTimeout(hideScrollHint, duration);
    }

    // ã‚«ã‚¹ã‚¿ãƒ ãƒ›ã‚¤ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼ˆPCç”¨ï¼‰
    function setupCustomWheelHandler() {
      if (isTouchDevice) return;
      
      const canvas = document.getElementById('commentChart');
      
      canvas.addEventListener('wheel', function(e) {
        if (!chart) return;
        
        const xScale = chart.scales.x;
        const currentMin = xScale.min || 0;
        const currentMax = xScale.max || totalDuration;
        const range = currentMax - currentMin;
        
        if (e.ctrlKey) {
          // Ctrl+ãƒ›ã‚¤ãƒ¼ãƒ«ï¼šã‚ºãƒ¼ãƒ ï¼ˆChart.jsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’ä½¿ç”¨ï¼‰
          disableTooltip();
          enableTooltipWithDelay(500);
          return;
        } else {
          // é€šå¸¸ã®ãƒ›ã‚¤ãƒ¼ãƒ«ï¼šãƒ‘ãƒ³
          e.preventDefault();
          
          // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’ç„¡åŠ¹åŒ–
          disableTooltip();
          
          const deltaX = e.deltaX;
          const deltaY = e.deltaY;
          
          const scrollDelta = deltaX !== 0 ? deltaX : deltaY;
          const scrollSensitivity = range * 0.03; 
          const timeShift = (scrollDelta > 0 ? 1 : -1) * scrollSensitivity;
          
          const newMin = Math.max(0, currentMin + timeShift);
          const newMax = Math.min(totalDuration, currentMax + timeShift);
          
          chart.options.scales.x.min = newMin;
          chart.options.scales.x.max = newMax;
          chart.update('none');
          
          updateTimeInfo();
          
          // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¾Œã«å°‘ã—é…å»¶ã—ã¦ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’å†æœ‰åŠ¹åŒ–
          enableTooltipWithDelay(300);
        }
      }, { passive: false });
    }

    // ã‚¿ãƒƒãƒãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰
    function setupTouchHandling() {
      if (!isTouchDevice) return;
      
      const canvas = document.getElementById('commentChart');
      
      let startX = 0;
      let startY = 0;
      let startTime = 0;
      let lastX = 0;
      let totalMovementX = 0;
      let totalMovementY = 0;
      
      canvas.addEventListener('touchstart', function(e) {
        const touch = e.touches[0];
        startX = lastX = touch.clientX;
        startY = touch.clientY;
        startTime = Date.now();
        totalMovementX = 0;
        totalMovementY = 0;
        hasMoved = false;
        isDragging = false;
        isScrolling = false;
        
        e.preventDefault();
      }, { passive: false });
      
      canvas.addEventListener('touchmove', function(e) {
        const touch = e.touches[0];
        const currentX = touch.clientX;
        const currentY = touch.clientY;
        
        const deltaX = currentX - lastX;
        totalMovementX += Math.abs(currentX - startX);
        totalMovementY += Math.abs(currentY - startY);
        
        // æ¨ªæ–¹å‘ã®å‹•ããŒç¸¦æ–¹å‘ã‚ˆã‚Šå¤§ãã„å ´åˆã®ã¿ãƒ‘ãƒ³ã‚’å®Ÿè¡Œ
        if (totalMovementX > 10 && totalMovementX > totalMovementY) {
          hasMoved = true;
          isDragging = true;
          isScrolling = true;
          
          // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é–‹å§‹æ™‚ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’ç„¡åŠ¹åŒ–
          disableTooltip();
          
          if (chart && chart.scales.x) {
            const xScale = chart.scales.x;
            const currentMin = xScale.min || 0;
            const currentMax = xScale.max || totalDuration;
            const range = currentMax - currentMin;
            const rect = canvas.getBoundingClientRect();
            const canvasWidth = rect.width;
            
            const basePixelRatio = range / canvasWidth;
            const sensitivityFactor = 0.3; 
            const pixelRatio = basePixelRatio * sensitivityFactor;
            const timeShift = -deltaX * pixelRatio;
            
            const newMin = Math.max(0, currentMin + timeShift);
            const newMax = Math.min(totalDuration, currentMax + timeShift);
            
            chart.options.scales.x.min = newMin;
            chart.options.scales.x.max = newMax;
            chart.update('none');
            
            updateTimeInfo();
            showScrollHint();
          }
        }
        
        lastX = currentX;
        e.preventDefault();
      }, { passive: false });
      
      canvas.addEventListener('touchend', function(e) {
        const endTime = Date.now();
        const touchDuration = endTime - startTime;
        
        setTimeout(hideScrollHint, 500);
        
        // ã‚¿ãƒƒãƒ—åˆ¤å®šï¼šçŸ­æ™‚é–“ && å°ã•ãªç§»å‹•
        const isTap = touchDuration < 400 && 
                     totalMovementX < 20 && 
                     totalMovementY < 20 && 
                     !hasMoved;
        
        if (isTap) {
          const currentTime = Date.now();
          const timeSinceLastTap = currentTime - lastTapTime;
          
          if (timeSinceLastTap < doubleTapDelay) {
            // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—æ¤œå‡º
            handleDoubleAction();
            lastTapTime = 0; // ãƒªã‚»ãƒƒãƒˆ
          } else {
            // ã‚·ãƒ³ã‚°ãƒ«ã‚¿ãƒƒãƒ—
            lastTapTime = currentTime;
          }
        }
        
        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«çµ‚äº†æ™‚ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’å†æœ‰åŠ¹åŒ–ï¼ˆå°‘ã—é…å»¶ï¼‰
        if (isDragging || isScrolling) {
          enableTooltipWithDelay(500);
        }
        
        // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
        setTimeout(() => {
          isDragging = false;
          isScrolling = false;
          hasMoved = false;
        }, 100);
        
        e.preventDefault();
      }, { passive: false });
    }

    // PCç”¨ã®ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    function setupDoubleClickHandling() {
      if (isTouchDevice) return;
      
      const canvas = document.getElementById('commentChart');
      
      canvas.addEventListener('click', function(e) {
        if (isDragging || isScrolling) {
          return;
        }
        
        const currentTime = Date.now();
        const timeSinceLastClick = currentTime - lastClickTime;
        
        if (timeSinceLastClick < doubleTapDelay) {
          // ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯æ¤œå‡º
          handleDoubleAction();
          lastClickTime = 0; // ãƒªã‚»ãƒƒãƒˆ
        } else {
          // ã‚·ãƒ³ã‚°ãƒ«ã‚¯ãƒªãƒƒã‚¯
          lastClickTime = currentTime;
        }
        
        e.preventDefault();
      });
    }

    // ãƒãƒ£ãƒ¼ãƒˆä½œæˆ
    function createChart(data) {
      chartData = data;
      const labels = data.map(d => d.time);
      const counts = data.map(d => d.count);
      totalDuration = Math.max(...labels);
      maxCommentCount = Math.max(...counts);

      const ctx = document.getElementById("commentChart").getContext("2d");

      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [{
            label: "ã‚³ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆ10ç§’ã”ã¨ï¼‰",
            data: counts,
            borderColor: "#42A5F5",
            backgroundColor: "rgba(66,165,245,0.15)",
            fill: true,
            tension: 0.4,
            pointRadius: 3,
            pointHoverRadius: 8,
            pointBackgroundColor: "#42A5F5",
            pointBorderColor: "#42A5F5",
            pointBorderWidth: 0,
            borderWidth: 2.5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            intersect: false,
            mode: 'nearest'
          },
          onHover: (event, elements) => {
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸­ã¯ãƒ›ãƒãƒ¼åŠ¹æœã‚‚ç„¡åŠ¹åŒ–
            if (!isTooltipEnabled) {
              return;
            }
          },
          scales: {
            x: {
              type: 'linear',
              position: 'bottom',
              min: 0,
              max: Math.min(1800, totalDuration),
              title: { 
                display: true, 
                text: "çµŒéæ™‚é–“",
                font: { size: 12, weight: 'bold' }
              },
              ticks: {
                callback: function(value) {
                  return formatTime(value);
                },
                maxTicksLimit: 8,
                font: { size: 11 }
              },
              grid: {
                color: 'rgba(0,0,0,0.08)'
              }
            },
            y: {
              beginAtZero: true,
              max: maxCommentCount,
              title: { 
                display: true, 
                text: "ã‚³ãƒ¡ãƒ³ãƒˆæ•°",
                font: { size: 12, weight: 'bold' }
              },
              ticks: {
                font: { size: 11 }
              },
              grid: {
                color: 'rgba(0,0,0,0.05)'
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            zoom: {
              pan: {
                enabled: !isTouchDevice,
                mode: 'x',
                modifierKey: null,
                onPanStart: () => {
                  disableTooltip();
                },
                onPanComplete: () => {
                  enableTooltipWithDelay(300);
                }
              },
              zoom: {
                wheel: {
                  enabled: true,
                  speed: 0.1,
                  modifierKey: 'ctrl'
                },
                pinch: {
                  enabled: isTouchDevice
                },
                mode: 'x',
                onZoomStart: () => {
                  disableTooltip();
                },
                onZoomComplete: () => {
                  updateTimeInfo();
                  enableTooltipWithDelay(300);
                }
              },
              limits: {
                x: { 
                  min: 0,
                  max: totalDuration,
                  minRange: 60
                },
                y: { 
                  min: 0,
                  max: maxCommentCount,
                  minRange: 1
                }
              }
            },
            tooltip: {
              enabled: true,
              backgroundColor: 'rgba(0,0,0,0.8)',
              titleColor: 'white',
              bodyColor: 'white',
              borderColor: '#42A5F5',
              borderWidth: 1,
              cornerRadius: 6,
              displayColors: false,
              filter: function(tooltipItem) {
                return isTooltipEnabled && !isDragging && !isScrolling;
              },
              callbacks: {
                title: (context) => `æ™‚é–“: ${formatTime(context[0].parsed.x)}`,
                label: (context) => `ã‚³ãƒ¡ãƒ³ãƒˆæ•°: ${context.parsed.y}ä»¶`,
                footer: () => isTouchDevice ? 'ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã§å‹•ç”»ã®ã“ã®æ™‚é–“ã«ç§»å‹•' : 'ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§å‹•ç”»ã®ã“ã®æ™‚é–“ã«ç§»å‹•'
              }
            }
          }
        }
      });

      updateTimeInfo();
      
      if (isTouchDevice) {
        setupTouchHandling();
        setTimeout(() => showScrollHintTemporary(), 500);
      } else {
        setupCustomWheelHandler();
        setupDoubleClickHandling();
      }
    }

    // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    fetch("../chart_data/" + VIDEO_ID + "_chart.json")
      .then(res => res.json())
      .then(data => {
        createChart(data);
      })
      .finally(() => {
        // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById("zoomIn").addEventListener("click", zoomIn);
        document.getElementById("zoomOut").addEventListener("click", zoomOut);
        document.getElementById("resetZoom").addEventListener("click", resetZoom);
        document.getElementById("showAll").addEventListener("click", showAll);
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById("confirmYes").addEventListener("click", () => {
          if (pendingUrl) {
            window.open(pendingUrl, '_blank');
          }
          hideConfirmModal();
        });
        
        document.getElementById("confirmNo").addEventListener("click", hideConfirmModal);
        
        document.getElementById("confirmModal").addEventListener("click", (e) => {
          if (e.target.id === 'confirmModal') {
            hideConfirmModal();
          }
        });
        
        window.addEventListener('resize', () => {
          if (chart) {
            setTimeout(() => chart.resize(), 100);
          }
        });
        
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            hideConfirmModal();
          }
        });
      });
  </script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 1rem;
      background: #f5f5f5;
      margin: 0;
      overflow-x: hidden;
    }

    .header {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: #333;
    }

    #chart-container {
      position: relative;
      height: 50vh;
      min-height: 300px;
      max-height: 600px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
      padding: 15px;
      box-sizing: border-box;
      overflow: hidden;
      touch-action: pan-y;
    }

    canvas {
      background: transparent;
      width: 100% !important;
      height: 100% !important;
      cursor: pointer;
    }

    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      min-height: 44px;
      box-sizing: border-box;
      touch-action: manipulation;
    }

    #resetZoom {
      background: #42A5F5;
      color: white;
    }

    #resetZoom:hover {
      background: #1E88E5;
      transform: translateY(-1px);
    }

    #showAll {
      background: #4CAF50;
      color: white;
    }

    #showAll:hover {
      background: #45a049;
      transform: translateY(-1px);
    }

    .zoom-controls {
      display: flex;
      gap: 5px;
      align-items: center;
    }

    .zoom-btn {
      background: #666;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: bold;
      touch-action: manipulation;
    }

    .zoom-btn:hover {
      background: #555;
    }

    .time-info {
      background: rgba(66, 165, 245, 0.1);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      color: #333;
      text-align: center;
      margin-top: 10px;
    }

    .instructions {
      margin-top: 1rem;
      padding: 12px;
      background: rgba(66, 165, 245, 0.1);
      border-radius: 8px;
      font-size: 13px;
      color: #555;
      text-align: center;
      line-height: 1.4;
    }

    .mobile-only {
      display: none;
    }

    .desktop-only {
      display: inline;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      backdrop-filter: blur(3px);
      touch-action: manipulation;
    }

    .modal-content {
      background-color: white;
      margin: 50% auto;
      transform: translateY(-50%);
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }

    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      min-width: 80px;
      transition: all 0.2s;
      touch-action: manipulation;
    }

    .modal-btn.confirm {
      background: #FF4444;
      color: white;
    }

    .modal-btn.confirm:hover {
      background: #CC3333;
    }

    .modal-btn.cancel {
      background: #eee;
      color: #333;
    }

    .modal-btn.cancel:hover {
      background: #ddd;
    }

    .scroll-hint {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      pointer-events: none;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.3s ease;
      white-space: nowrap;
    }

    .scroll-hint.show {
      opacity: 1;
    }

    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }
      
      .header {
        font-size: 1.1rem;
      }
      
      #chart-container {
        height: 45vh;
        min-height: 280px;
        padding: 12px;
        touch-action: pan-y pinch-zoom;
      }

      canvas {
        touch-action: none;
      }
      
      .btn {
        font-size: 13px;
        padding: 8px 14px;
      }
      
      .instructions {
        font-size: 12px;
      }

      .mobile-only {
        display: inline;
      }

      .desktop-only {
        display: none;
      }

      .modal-content {
        margin: 40% auto;
        width: 95%;
        padding: 16px;
      }

      .scroll-hint {
        bottom: 12px;
        font-size: 11px;
        padding: 6px 12px;
      }
    }

    @media (max-width: 480px) {
      #chart-container {
        height: 40vh;
        min-height: 250px;
      }
    }
  </style>
</body>
</html>